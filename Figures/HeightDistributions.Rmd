---
title: "Height_Distributions"
author: "Ben Weinstein"
date: "3/10/2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(raster)
library(dplyr)
library(ggplot2)

library(tidyr)
library(stringr)
```

```{r}
df<-read.csv("averages.csv",row.names =1)
counts<-read.csv("counts.csv")
colnames(counts)<-c("Site","geo_index","Year","n")
```

```{r}
ggplot(df,aes(x=height,y=area,size=n)) + geom_point(alpha=0.5) + labs(x="Crown Height (m)",y="Crown Area (m^2)",size="Trees/km^2") + geom_text(aes(label=Site),size=3,hjust=0.25,vjust=-0.5) + theme_bw()
ggsave("Attributes.png",height=5,width=8)
ggsave("Attributes.svg", height=5,width=8)
```

## Counts through time

```{r}
counts %>% spread(Year,n) %>% ggplot(.,aes(x=`2019`,y=`2018`)) + geom_point(aes(col=Site),alpha=0.5) + geom_abline(linetype="dashed") + coord_equal()
```

```{r}
counts %>% group_by(Site,Year) %>% summarize(n=sum(n)) %>% spread(Year,n) %>% ggplot(.,aes(x=`2019`,y=`2018`)) + geom_point() + geom_abline(linetype="dashed") + coord_equal() + geom_text(aes(label=Site))
```

#Tree Falls
```{r}
treedf<-read.csv("treefall.csv",row.names= 1)
ggplot(treedf,aes(x=Site,y=mean,ymin=lower,ymax=upper)) + geom_pointrange(size=1) + theme_bw() + labs(y="Tree Falls per 1km^2")

treedf %>% inner_join(df[,c("Site","n")]) %>% ggplot(.,aes(x=n,y=mean,ymin=lower,ymax=upper)) + geom_pointrange() + geom_text(aes(label=Site),vjust=0.25,hjust=-0.25) + labs(x="Trees per 1km^2",y="Tree Falls per 1km^2")
ggsave("TreeFalls.png",height=4,width=6)
```

```{r}
treedf %>% inner_join(df[,c("Site","n")]) %>% ggplot(.,aes(x=n,y=mean,ymin=lower,ymax=upper)) + geom_pointrange(alpha=0.7) + geom_text(aes(label=Site),vjust=-1,hjust=0,size=2) + labs(x="Trees per 1km^2",y="Tree Falls per 1km^2")
ggsave("TreeFallRate.png",height=4,width=6)
```




